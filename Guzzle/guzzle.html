<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Guzzle</title>
    <meta name="description" content="#">
    <meta name="keywords" content="#">

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

</head>

<body>
    <p>Bitcoin Price Index</p>
    <input type="text" id="startDate" name="startDate" placeholder="start date" class="input">
    <input type="text" id="endDate" name="endDate" placeholder="end date" class="input">
    <button id="button" type="submit">go</button>

    <div id="result"></div>
    <br>
    <a href="https://www.coindesk.com/price/bitcoin">Powered by CoinDesk</a>

    <script>
        $(function () {
            $("#startDate").datepicker({
                dateFormat: 'yy-mm-dd'
            });
            $("#endDate").datepicker({
                dateFormat: 'yy-mm-dd'
            });
            $("#button").prop("disabled", true)
        });

        $("#startDate, #endDate").on('change', function () {
            if ($("#startDate").val() != "" && $("#endDate").val() != "" && $("#startDate").val() <= $(
                    "#endDate").val()) {
                $("#button").prop("disabled", false)
                $("#button").off('click').on('click', sendDates);
            };
        });

        function sendDates() {
            $.ajax({
                type: 'POST',
                url: '/Guzzle/guzzle.php',
                dataType: 'json',
                async: true,
                data: {
                    startDate: $("#startDate").val(),
                    endDate: $("#endDate").val()
                },
                success: function (data) {
                    let items = [];
                    $.each(data.bpi, function (key, val) {
                        items.push("<li>day: " + key + " price: " + val + " USD</li>")
                    });
                    $('#result').empty().append(items);
                },
                error: function (e) {
                    console.log(e);
                },
            });
        };
    </script>
</body>

</html>